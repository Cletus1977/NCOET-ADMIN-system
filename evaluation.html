<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCOET Teaching Practice Evaluation System</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        :root {
            --primary:#1a4d2e; --primary-light:#2d6a4f; --accent:#f77f00; --accent-light:#fcbf49;
            --bg-main:#faf9f6; --bg-card:#ffffff; --text-dark:#1b1b1b; --text-medium:#4a4a4a;
            --border:#e0dfd8; --success:#52b788; --danger:#dc3545;
        }
        body { font-family:'DM Sans',sans-serif; background:linear-gradient(135deg,#faf9f6,#f0efe8); color:var(--text-dark); line-height:1.6; min-height:100vh; }
        .app-header { background:var(--primary); color:white; padding:2.5rem 2rem; text-align:center; position:relative; overflow:hidden; }
        .app-header::before { content:''; position:absolute; top:-50%; right:-10%; width:500px; height:500px; background:radial-gradient(circle,rgba(255,255,255,0.15)0%,transparent 70%); border-radius:50%; }
        .app-header h1 { font-family:'Playfair Display',serif; font-size:2.5rem; font-weight:900; margin-bottom:0.5rem; letter-spacing:-0.5px; }
        .container { max-width:1400px; margin:0 auto; padding:2rem; }
        .nav-tabs { display:flex; gap:1rem; margin-bottom:2rem; background:var(--bg-card); padding:0.5rem; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
        .tab-btn { flex:1; padding:1rem; background:transparent; border:none; border-radius:8px; font-weight:500; cursor:pointer; transition:all 0.3s; }
        .tab-btn.active { background:var(--primary); color:white; box-shadow:0 4px 12px rgba(26,77,46,0.2); }
        .tab-content { display:none; }
        .tab-content.active { display:block; animation:fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .card { background:var(--bg-card); border-radius:16px; padding:2rem; margin-bottom:2rem; box-shadow:0 4px 20px rgba(0,0,0,0.06); border:1px solid var(--border); }
        .card-header { display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:2px solid var(--border); }
        .card-header-left { display:flex; align-items:center; gap:1rem; }
        .card-number { width:48px; height:48px; background:linear-gradient(135deg,var(--accent)0%,var(--accent-light)100%); border-radius:12px; display:flex; align-items:center; justify-content:center; font-family:'Playfair Display',serif; font-size:1.5rem; color:white; box-shadow:0 4px 12px rgba(247,127,0,0.2); }
        .card-title { font-family:'Playfair Display',serif; font-size:1.5rem; font-weight:700; color:var(--primary); }
        .form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:1.5rem; margin-bottom:2rem; }
        label { font-weight:500; margin-bottom:0.5rem; display:block; color:var(--text-dark); }
        input[type=text],input[type=date],input[type=email],textarea { padding:0.875rem 1rem; border:2px solid var(--border); border-radius:8px; width:100%; background:var(--bg-main); transition:all 0.3s; }
        input:focus,textarea:focus { outline:none; border-color:var(--primary); background:white; box-shadow:0 0 0 3px rgba(26,77,46,0.1); }
        .evaluation-table { width:100%; border-collapse:separate; border-spacing:0; margin:1rem 0 2rem; }
        .evaluation-table thead { background:var(--primary); color:white; }
        .evaluation-table th { padding:1rem 0.5rem; text-align:center; font-weight:600; font-size:0.9rem; }
        .evaluation-table th:first-child { border-top-left-radius:8px; text-align:left; padding-left:1rem; }
        .evaluation-table th:last-child { border-top-right-radius:8px; }
        .evaluation-table td { padding:1rem 0.5rem; border-bottom:1px solid var(--border); text-align:center; }
        .evaluation-table td:first-child { text-align:left; padding-left:1rem; }
        .evaluation-table tbody tr:hover { background:var(--bg-main); }
        .indicator-text { font-size:0.95rem; color:var(--text-dark); }
        input[type="radio"] { width:20px; height:20px; cursor:pointer; accent-color:var(--primary); }
        .sub-indicator { margin-bottom:2.5rem; }
        .sub-indicator h4 { color:var(--primary); margin-bottom:0.75rem; font-size:1.2rem; }
        .summary-section { background:linear-gradient(135deg,var(--primary),var(--primary-light)); color:white; padding:2rem; border-radius:12px; margin-top:2rem; }
        .summary-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:1.5rem; margin-top:1rem; }
        .summary-item { text-align:center; padding:1.5rem; background:rgba(255,255,255,0.15); border-radius:8px; }
        .summary-value { font-size:2.2rem; font-weight:700; font-family:'Playfair Display',serif; }
        .analysis-section { background:white; padding:2rem; border-radius:12px; margin-top:2rem; border:2px solid var(--border); }
        .analysis-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; }
        .analysis-item { padding:1.5rem; background:var(--bg-main); border-radius:8px; border-left:4px solid var(--primary); }
        .analysis-item h4 { color:var(--primary); margin-bottom:0.5rem; }
        .analysis-item .value { font-size:1.5rem; font-weight:700; color:var(--accent); }
        .grade-badge { padding:0.6rem 1.5rem; border-radius:20px; font-weight:700; font-size:1.2rem; display:inline-block; }
        .grade-a { background:#d1f4e0; color:#1e6f45; }
        .grade-b { background:#d4edda; color:#155724; }
        .grade-c { background:#fff3cd; color:#856404; }
        .grade-d { background:#f8d7da; color:#721c24; }
        .btn { padding:0.9rem 1.8rem; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.3s; }
        .btn-primary { background:linear-gradient(135deg,var(--accent),var(--accent-light)); color:white; }
        .btn-primary:hover { transform:translateY(-2px); }
        .btn-secondary { background:var(--primary); color:white; }
        .btn-success { background:var(--success); color:white; }
        .btn-danger { background:var(--danger); color:white; }
        .btn-group { display:flex; gap:1rem; justify-content:center; flex-wrap:wrap; margin-top:2rem; }
        .students-list { display:grid; gap:1.2rem; }
        .student-card { background:white; padding:1.5rem; border-radius:12px; border:2px solid var(--border); display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem; transition:all 0.3s; }
        .student-card:hover { border-color:var(--primary); box-shadow:0 4px 15px rgba(26,77,46,0.1); }
        .student-actions { display:flex; gap:0.6rem; flex-wrap:wrap; }
        .empty-state { text-align:center; padding:4rem 2rem; color:var(--text-medium); }
        .alert { padding:1rem 1.5rem; border-radius:8px; margin-bottom:1rem; display:none; align-items:center; gap:0.8rem; }
        .alert.show { display:flex; animation:slideDown 0.3s; }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
        .alert-success { background:#d1f4e0; color:#1e6f45; }
        .alert-error { background:#ffe5e5; color:#c92a2a; }
        .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1.5rem; margin-bottom:2rem; }
        .stat-card { background:white; padding:1.5rem; border-radius:12px; border-left:4px solid var(--primary); box-shadow:0 2px 8px rgba(0,0,0,0.05); }
        .stat-card .value { font-size:2rem; font-weight:700; color:var(--primary); font-family:'Playfair Display',serif; }
        @media (max-width:768px) {
            .container { padding:1rem; }
            .app-header h1 { font-size:1.8rem; }
            .form-grid { grid-template-columns:1fr; }
            .btn-group { flex-direction:column; }
            .btn { width:100%; justify-content:center; }
            .student-card { flex-direction:column; align-items:flex-start; }
        }
    </style>
</head>
<body>
<div class="app-header">
    <h1>Teaching Practicum Evaluation System</h1>
    <p>National College of Education On Technology - Kuliyapitiya</p>
</div>
<div class="container">
    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('new-evaluation',this)">‚ûï New Evaluation</button>
        <button class="tab-btn" onclick="switchTab('view-records',this)">üìã View Records</button>
        <button class="tab-btn" onclick="switchTab('dashboard',this)">üìà Dashboard</button>
    </div>
    <div id="alert-container"></div>

    <!-- NEW EVALUATION -->
    <div id="new-evaluation" class="tab-content active">
        <!-- Student Info -->
        <div class="card">
            <div class="card-header">
                <div class="card-header-left">
                    <div class="card-number">üìã</div>
                    <h2 class="card-title">STUDENT INFORMATION</h2>
                </div>
            </div>
            <div class="form-grid">
                <div><label>Registration Number *</label><input type="text" id="regNo" required></div>
                <div><label>Student Name *</label><input type="text" id="studentName" required></div>
                <div><label>Student Email *</label><input type="email" id="studentEmail" required></div>
                <div><label>Practice School *</label><input type="text" id="schoolName" required></div>
                <div><label>Evaluation Date *</label><input type="date" id="evalDate" required></div>
            </div>
        </div>

        <!-- Evaluator Info -->
        <div class="card">
            <div class="card-header">
                <div class="card-header-left">
                    <div class="card-number">üë®‚Äçüè´</div>
                    <h2 class="card-title">EVALUATOR INFORMATION</h2>
                </div>
            </div>
            <div class="form-grid">
                <div><label>Lecturer Name *</label><input type="text" id="evaluatorName" required></div>
                <div><label>Lecturer Reg No *</label><input type="text" id="evaluatorRegNo" required></div>
                <div><label>Lecturer Email *</label><input type="email" id="evaluatorEmail" required></div>
            </div>
        </div>

        <!-- Section 1 -->
        <div class="card">
            <div class="card-header">
                <div class="card-header-left">
                    <div class="card-number">1</div>
                    <h2 class="card-title">PLANNING THE LESSON (20 marks)</h2>
                </div>
            </div>
            <table class="evaluation-table">
                <thead><tr><th style="width:45%;">Indicator</th><th>5</th><th>4</th><th>3</th><th>2</th><th>Should be Developed</th></tr></thead>
                <tbody>
                    <tr><td class="indicator-text">1.1 IDENTIFYING OBJECTIVES/GOALS OF THE LESSON<br><span style="color:#666;font-size:0.9rem;">‚Ä¢ Suitability ‚Ä¢ Correctness ‚Ä¢ Practicability ‚Ä¢ Matching competencies ‚Ä¢ Knowledge/attitudes/skills</span></td>
                        <td><input type="radio" name="prep_1_1" value="5"></td><td><input type="radio" name="prep_1_1" value="4"></td><td><input type="radio" name="prep_1_1" value="3"></td><td><input type="radio" name="prep_1_1" value="2"></td><td><input type="radio" name="prep_1_1" value="1"></td></tr>
                    <tr><td class="indicator-text">1.2 SELECTION OF SUBJECT CONTENT AND ORGANIZATION<br><span style="color:#666;font-size:0.9rem;">‚Ä¢ Matching outcomes ‚Ä¢ Sufficiency ‚Ä¢ Sequential order ‚Ä¢ Student level ‚Ä¢ Correctness</span></td>
                        <td><input type="radio" name="prep_1_2" value="5"></td><td><input type="radio" name="prep_1_2" value="4"></td><td><input type="radio" name="prep_1_2" value="3"></td><td><input type="radio" name="prep_1_2" value="2"></td><td><input type="radio" name="prep_1_2" value="1"></td></tr>
                    <tr><td class="indicator-text">1.3 SELECTION OF METHODS, TECHNIQUES & RESOURCES<br><span style="color:#666;font-size:0.9rem;">‚Ä¢ Proper selection ‚Ä¢ Suitable materials ‚Ä¢ Monitoring ‚Ä¢ Accuracy</span></td>
                        <td><input type="radio" name="prep_1_3" value="5"></td><td><input type="radio" name="prep_1_3" value="4"></td><td><input type="radio" name="prep_1_3" value="3"></td><td><input type="radio" name="prep_1_3" value="2"></td><td><input type="radio" name="prep_1_3" value="1"></td></tr>
                    <tr><td class="indicator-text">1.4 LESSON PLAN<br><span style="color:#666;font-size:0.9rem;">‚Ä¢ Suitable method ‚Ä¢ Clarity & completeness ‚Ä¢ Activities ‚Ä¢ Subject per step ‚Ä¢ Time allocation</span></td>
                        <td><input type="radio" name="prep_1_4" value="5"></td><td><input type="radio" name="prep_1_4" value="4"></td><td><input type="radio" name="prep_1_4" value="3"></td><td><input type="radio" name="prep_1_4" value="2"></td><td><input type="radio" name="prep_1_4" value="1"></td></tr>
                </tbody>
            </table>
        </div>

        <!-- Section 2 -->
        <div class="card">
            <div class="card-header">
                <div class="card-header-left">
                    <div class="card-number">2</div>
                    <h2 class="card-title">IMPLEMENTATION OF THE LESSON PLAN (60 marks)</h2>
                </div>
            </div>
            <!-- 2.1 -->
            <div class="sub-indicator">
                <h4>2.1 Selecting the Scene (5 marks)</h4>
                <table class="evaluation-table">
                    <thead><tr><th style="width:45%;">Indicator</th><th>5</th><th>4</th><th>3</th><th>2</th><th>Should be Developed</th></tr></thead>
                    <tbody><tr><td class="indicator-text">‚Ä¢ Suitability ‚Ä¢ Attention ‚Ä¢ Previous knowledge ‚Ä¢ Creativity ‚Ä¢ Motivation</td>
                        <td><input type="radio" name="dev_2_1" value="5"></td><td><input type="radio" name="dev_2_1" value="4"></td><td><input type="radio" name="dev_2_1" value="3"></td><td><input type="radio" name="dev_2_1" value="2"></td><td><input type="radio" name="dev_2_1" value="1"></td></tr></tbody>
                </table>
            </div>
            <!-- 2.2 -->
            <div class="sub-indicator">
                <h4>2.2 Development of the Lesson (20 marks)</h4>
                <table class="evaluation-table">
                    <thead><tr><th style="width:40%;">Indicator</th><th>20</th><th>18</th><th>16</th><th>14</th><th>12</th><th>10</th><th>8</th><th>6</th><th>4</th><th>Should be Developed</th></tr></thead>
                    <tbody><tr><td class="indicator-text">‚Ä¢ Methods correctly ‚Ä¢ Verbal ‚Ä¢ Activities ‚Ä¢ Non-verbal ‚Ä¢ Instructions ‚Ä¢ Step-by-step ‚Ä¢ Questioning ‚Ä¢ Pace ‚Ä¢ Motivation ‚Ä¢ Life situations</td>
                        <td><input type="radio" name="dev_2_2" value="20"></td><td><input type="radio" name="dev_2_2" value="18"></td><td><input type="radio" name="dev_2_2" value="16"></td><td><input type="radio" name="dev_2_2" value="14"></td><td><input type="radio" name="dev_2_2" value="12"></td>
                        <td><input type="radio" name="dev_2_2" value="10"></td><td><input type="radio" name="dev_2_2" value="8"></td><td><input type="radio" name="dev_2_2" value="6"></td><td><input type="radio" name="dev_2_2" value="4"></td><td><input type="radio" name="dev_2_2" value="2"></td></tr></tbody>
                </table>
            </div>
            <!-- 2.3 to 2.7 (same as pro 02 but cleaned) -->
            <div class="sub-indicator"><h4>2.3 Use of Learning Aids (10 marks)</h4>
                <table class="evaluation-table"><thead><tr><th style="width:45%;">Indicator</th><th>10</th><th>8</th><th>6</th><th>4</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">‚Ä¢ Aids for content ‚Ä¢ Blackboard ‚Ä¢ Student use ‚Ä¢ Active learning ‚Ä¢ Quantity</td>
                    <td><input type="radio" name="dev_2_3" value="10"></td><td><input type="radio" name="dev_2_3" value="8"></td><td><input type="radio" name="dev_2_3" value="6"></td><td><input type="radio" name="dev_2_3" value="4"></td><td><input type="radio" name="dev_2_3" value="2"></td></tr></tbody></table>
            </div>
            <div class="sub-indicator"><h4>2.4 Time Management (5 marks)</h4>
                <table class="evaluation-table"><thead><tr><th style="width:45%;">Indicator</th><th>5</th><th>4</th><th>3</th><th>2</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">‚Ä¢ No delay ‚Ä¢ Proper use ‚Ä¢ Tasks completed ‚Ä¢ Situational ‚Ä¢ On time</td>
                    <td><input type="radio" name="dev_2_4" value="5"></td><td><input type="radio" name="dev_2_4" value="4"></td><td><input type="radio" name="dev_2_4" value="3"></td><td><input type="radio" name="dev_2_4" value="2"></td><td><input type="radio" name="dev_2_4" value="1"></td></tr></tbody></table>
            </div>
            <div class="sub-indicator"><h4>2.5 Teacher-Pupil Relationship (5 marks)</h4>
                <table class="evaluation-table"><thead><tr><th style="width:45%;">Indicator</th><th>5</th><th>4</th><th>3</th><th>2</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">‚Ä¢ Building relations ‚Ä¢ Close relations ‚Ä¢ All participate ‚Ä¢ Special needs ‚Ä¢ Democratic</td>
                    <td><input type="radio" name="dev_2_5" value="5"></td><td><input type="radio" name="dev_2_5" value="4"></td><td><input type="radio" name="dev_2_5" value="3"></td><td><input type="radio" name="dev_2_5" value="2"></td><td><input type="radio" name="dev_2_5" value="1"></td></tr></tbody></table>
            </div>
            <div class="sub-indicator"><h4>2.6 Classroom Management (10 marks)</h4>
                <table class="evaluation-table"><thead><tr><th style="width:45%;">Indicator</th><th>10</th><th>8</th><th>6</th><th>4</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">‚Ä¢ Movements ‚Ä¢ Guidance ‚Ä¢ Arrangement ‚Ä¢ Misbehaviors ‚Ä¢ Attention</td>
                    <td><input type="radio" name="dev_2_6" value="10"></td><td><input type="radio" name="dev_2_6" value="8"></td><td><input type="radio" name="dev_2_6" value="6"></td><td><input type="radio" name="dev_2_6" value="4"></td><td><input type="radio" name="dev_2_6" value="1"></td></tr></tbody></table>
            </div>
            <div class="sub-indicator"><h4>2.7 Completion of the Lesson (5 marks)</h4>
                <table class="evaluation-table"><thead><tr><th style="width:45%;">Indicator</th><th>5</th><th>4</th><th>3</th><th>2</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">‚Ä¢ Review ‚Ä¢ Sufficiency ‚Ä¢ Summary ‚Ä¢ Extension ‚Ä¢ Future clues</td>
                    <td><input type="radio" name="dev_2_7" value="5"></td><td><input type="radio" name="dev_2_7" value="4"></td><td><input type="radio" name="dev_2_7" value="3"></td><td><input type="radio" name="dev_2_7" value="2"></td><td><input type="radio" name="dev_2_7" value="1"></td></tr></tbody></table>
            </div>
        </div>

        <!-- Section 3 & 4 -->
        <div class="card">
            <div class="card-header"><div class="card-header-left"><div class="card-number">3</div><h2 class="card-title">ASSESSMENT AND EVALUATION (10 marks)</h2></div></div>
            <table class="evaluation-table">
                <thead><tr><th style="width:45%;">Indicator</th><th>10</th><th>8</th><th>6</th><th>4</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">3.1 USE OF ASSESSMENT METHODS<br><span style="color:#666;font-size:0.9rem;">‚Ä¢ Correct tools ‚Ä¢ Validity ‚Ä¢ Feedback ‚Ä¢ Implementation ‚Ä¢ Remedial</span></td>
                    <td><input type="radio" name="assess_3_1" value="10"></td><td><input type="radio" name="assess_3_1" value="8"></td><td><input type="radio" name="assess_3_1" value="6"></td><td><input type="radio" name="assess_3_1" value="4"></td><td><input type="radio" name="assess_3_1" value="2"></td></tr></tbody>
            </table>
        </div>
        <div class="card">
            <div class="card-header"><div class="card-header-left"><div class="card-number">4</div><h2 class="card-title">PERSONALITY OF THE TEACHER (10 marks)</h2></div></div>
            <table class="evaluation-table">
                <thead><tr><th style="width:45%;">Indicator</th><th>10</th><th>8</th><th>6</th><th>4</th><th>Should be Developed</th></tr></thead>
                <tbody><tr><td class="indicator-text">4.1 SPECIFIC CHARACTERISTICS<br><span style="color:#666;font-size:0.9rem;">‚Ä¢ Dress & appearance ‚Ä¢ Confidence ‚Ä¢ Challenges ‚Ä¢ Proficiency ‚Ä¢ Voice & commitment</span></td>
                    <td><input type="radio" name="person_4_1" value="10"></td><td><input type="radio" name="person_4_1" value="8"></td><td><input type="radio" name="person_4_1" value="6"></td><td><input type="radio" name="person_4_1" value="4"></td><td><input type="radio" name="person_4_1" value="1"></td></tr></tbody>
            </table>
        </div>

        <!-- Proposals -->
        <div class="card">
            <div class="card-header"><div class="card-header-left"><div class="card-number">üí°</div><h2 class="card-title">Developmental Proposals / Strengths</h2></div></div>
            <textarea id="proposals" placeholder="Strengths, areas for development, recommendations..."></textarea>
        </div>

        <!-- Summary + Analysis -->
        <div class="summary-section">
            <h3 style="text-align:center;margin-bottom:1rem;">Evaluation Summary</h3>
            <div class="summary-grid">
                <div class="summary-item"><div>Maximum</div><div class="summary-value">100</div></div>
                <div class="summary-item"><div>Indicators Evaluated</div><div class="summary-value" id="evaluatedCount">0</div></div>
                <div class="summary-item"><div>Total Marks</div><div class="summary-value" id="totalMarks">0</div><div id="percentageBadge" style="font-size:1.3rem;margin-top:0.5rem;">0%</div></div>
            </div>
        </div>

        <div class="analysis-section">
            <h3 style="text-align:center;color:var(--primary);margin-bottom:1.5rem;">Performance Analysis</h3>
            <div class="analysis-grid">
                <div class="analysis-item"><h4>Planning</h4><div class="value" id="sec1">0/20</div><div id="sec1p" style="color:#666;">0%</div></div>
                <div class="analysis-item"><h4>Implementation</h4><div class="value" id="sec2">0/60</div><div id="sec2p" style="color:#666;">0%</div></div>
                <div class="analysis-item"><h4>Assessment</h4><div class="value" id="sec3">0/10</div><div id="sec3p" style="color:#666;">0%</div></div>
                <div class="analysis-item"><h4>Personality</h4><div class="value" id="sec4">0/10</div><div id="sec4p" style="color:#666;">0%</div></div>
            </div>
            <div style="text-align:center;margin-top:2rem;">
                <h4 style="color:var(--primary);">Overall Grade</h4>
                <div class="grade-badge" id="gradeBadge">‚Äî</div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
            <button class="btn btn-primary" onclick="saveEvaluation()">üíæ Save & Send Emails</button>
        </div>
    </div>

    <!-- VIEW RECORDS -->
    <div id="view-records" class="tab-content">
        <div class="card">
            <div class="card-header">
                <div class="card-header-left">
                    <div class="card-number">üìã</div>
                    <h2 class="card-title">Saved Evaluations</h2>
                </div>
                <button class="btn btn-success" onclick="downloadCSV()">üì• Export CSV</button>
            </div>
            <div id="studentsList" class="students-list"></div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="tab-content">
        <div class="card">
            <div class="card-header"><div class="card-header-left"><div class="card-number">üìà</div><h2 class="card-title">Dashboard Overview</h2></div></div>
            <div class="stats-grid">
                <div class="stat-card"><h3>Total Evaluations</h3><div class="value" id="dashTotal">0</div></div>
                <div class="stat-card"><h3>Average Score</h3><div class="value" id="dashAvg">0%</div></div>
                <div class="stat-card"><h3>Grade A</h3><div class="value" id="dashA">0</div></div>
                <div class="stat-card"><h3>Grade B</h3><div class="value" id="dashB">0</div></div>
                <div class="stat-card"><h3>Grade C</h3><div class="value" id="dashC">0</div></div>
            </div>
            <h3 style="margin:2rem 0 1rem;color:var(--primary);">Average by Section</h3>
            <div class="analysis-grid">
                <div class="analysis-item"><h4>Planning</h4><div class="value" id="dashSec1">0%</div></div>
                <div class="analysis-item"><h4>Implementation</h4><div class="value" id="dashSec2">0%</div></div>
                <div class="analysis-item"><h4>Assessment</h4><div class="value" id="dashSec3">0%</div></div>
                <div class="analysis-item"><h4>Personality</h4><div class="value" id="dashSec4">0%</div></div>
            </div>
        </div>
    </div>
</div>

<script>
const STORAGE_KEY = 'ncoet_eval_final_2026';
function loadData(){ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }
function saveData(arr){ localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); }

function switchTab(id,btn){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    if(id==='view-records') loadRecords();
    if(id==='dashboard') loadDashboard();
}

function getSectionScores(){
    const defs = {
        sec1: {names:['prep_1_1','prep_1_2','prep_1_3','prep_1_4'],max:20},
        sec2: {names:['dev_2_1','dev_2_2','dev_2_3','dev_2_4','dev_2_5','dev_2_6','dev_2_7'],max:60},
        sec3: {names:['assess_3_1'],max:10},
        sec4: {names:['person_4_1'],max:10}
    };
    let res = {};
    Object.keys(defs).forEach(k=>{
        let sc = 0;
        defs[k].names.forEach(n=>{
            const ch = document.querySelector(`input[name="${n}"]:checked`);
            if(ch) sc += +ch.value;
        });
        res[k] = {score:sc, perc:defs[k].max?(sc/defs[k].max*100).toFixed(1):0};
    });
    return res;
}

function updateLive(){
    let total = 0, count = 0;
    document.querySelectorAll('input[type=radio]:checked').forEach(r=>{ total += +r.value; count++; });
    document.getElementById('totalMarks').textContent = total;
    const perc = total;
    document.getElementById('percentageBadge').textContent = perc + '%';
    document.getElementById('evaluatedCount').textContent = count;

    const secs = getSectionScores();
    document.getElementById('sec1').textContent = secs.sec1.score+'/20';
    document.getElementById('sec1p').textContent = secs.sec1.perc+'%';
    document.getElementById('sec2').textContent = secs.sec2.score+'/60';
    document.getElementById('sec2p').textContent = secs.sec2.perc+'%';
    document.getElementById('sec3').textContent = secs.sec3.score+'/10';
    document.getElementById('sec3p').textContent = secs.sec3.perc+'%';
    document.getElementById('sec4').textContent = secs.sec4.score+'/10';
    document.getElementById('sec4p').textContent = secs.sec4.perc+'%';

    let grade = '‚Äî', cls='';
    if(perc>=80){grade='A - Excellent'; cls='grade-a';}
    else if(perc>=65){grade='B - Very Good'; cls='grade-b';}
    else if(perc>=50){grade='C - Good'; cls='grade-c';}
    else if(perc>0){grade='D - Needs Development'; cls='grade-d';}
    const g = document.getElementById('gradeBadge');
    g.textContent = grade;
    g.className = 'grade-badge '+cls;
}

function attachListeners(){
    document.querySelectorAll('input[type=radio]').forEach(r=>r.addEventListener('change',updateLive));
}

function saveEvaluation(){
    const fields = ['regNo','studentName','studentEmail','schoolName','evalDate','evaluatorName','evaluatorRegNo','evaluatorEmail'];
    for(let f of fields){
        if(!document.getElementById(f).value.trim()){ showAlert('All required fields must be filled','error'); return; }
    }
    if(+document.getElementById('totalMarks').textContent===0 && !confirm('No scores entered. Save anyway?')) return;

    const secs = getSectionScores();
    const data = {
        id: Date.now(),
        regNo: document.getElementById('regNo').value.trim(),
        studentName: document.getElementById('studentName').value.trim(),
        studentEmail: document.getElementById('studentEmail').value.trim(),
        schoolName: document.getElementById('schoolName').value.trim(),
        evalDate: document.getElementById('evalDate').value,
        evaluatorName: document.getElementById('evaluatorName').value.trim(),
        evaluatorRegNo: document.getElementById('evaluatorRegNo').value.trim(),
        evaluatorEmail: document.getElementById('evaluatorEmail').value.trim(),
        proposals: document.getElementById('proposals').value.trim(),
        totalMarks: +document.getElementById('totalMarks').textContent,
        percentage: +document.getElementById('totalMarks').textContent,
        grade: document.getElementById('gradeBadge').textContent,
        sectionScores: secs,
        timestamp: new Date().toISOString()
    };

    let arr = loadData();
    arr.push(data);
    saveData(arr);
    showAlert('Evaluation saved successfully!','success');
    sendEmails(data);
    resetForm();
    setTimeout(()=>{switchTab('view-records',document.querySelector('[onclick*="view-records"]'));},1200);
}

function sendEmails(d){
    const subj = `NCOET Teaching Practice Evaluation ‚Äì ${d.studentName} (${d.regNo})`;
    const dt = new Date(d.evalDate).toLocaleDateString('en-GB');
    const body = `Student: ${d.studentName} (${d.regNo})\nSchool: ${d.schoolName}\nDate: ${dt}\nEvaluator: ${d.evaluatorName} (${d.evaluatorRegNo})\nScore: ${d.totalMarks}/100 (${d.percentage}%)\nGrade: ${d.grade}\n\nDevelopmental Proposals:\n${d.proposals||'None provided'}`;

    window.open(`mailto:${d.studentEmail}?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent("Dear "+d.studentName+",\n\n"+body+"\n\nBest regards,\n"+d.evaluatorName)}`);
    setTimeout(()=>window.open(`mailto:${d.evaluatorEmail}?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent("Evaluation submitted:\n"+body)}`),600);
    setTimeout(()=>window.open(`mailto:ncoetkuliyapitiya@gmail.com?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent("New evaluation received:\n"+body+"\n\nEvaluator: "+d.evaluatorName+" ("+d.evaluatorRegNo+")")}`),1300);
}

function resendEmails(id){
    const item = loadData().find(e=>e.id===id);
    if(!item) return;
    if(!confirm(`Re-send emails for ${item.studentName}?`)) return;
    sendEmails(item);
    showAlert('Email windows opened','success');
}

function resetForm(){
    document.querySelectorAll('#new-evaluation input, #new-evaluation textarea').forEach(el=>el.value='');
    document.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false);
    document.getElementById('evalDate').valueAsDate = new Date();
    updateLive();
}

function showAlert(msg,type='success'){
    const el = document.createElement('div');
    el.className = `alert alert-${type} show`;
    el.innerHTML = `<strong>${type==='success'?'‚úÖ Success':'‚ö†Ô∏è Error'}:</strong> ${msg}`;
    document.getElementById('alert-container').appendChild(el);
    setTimeout(()=>el.remove(),5000);
}

function loadRecords(){
    const cont = document.getElementById('studentsList');
    const data = loadData().sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
    if(!data.length){
        cont.innerHTML = `<div class="empty-state"><h3>No evaluations saved yet</h3><p>Create one in New Evaluation</p></div>`;
        return;
    }
    cont.innerHTML = data.map(d=>`
        <div class="student-card">
            <div>
                <h3>${d.studentName}</h3>
                <p>Reg: ${d.regNo} ‚Ä¢ School: ${d.schoolName}</p>
                <p>Date: ${new Date(d.evalDate).toLocaleDateString()} ‚Ä¢ Evaluator: ${d.evaluatorName} (${d.evaluatorRegNo})</p>
                <p><strong>${d.totalMarks}/100 (${d.percentage}%)</strong> ‚Äî ${d.grade}</p>
            </div>
            <div class="student-actions">
                <button class="btn btn-secondary" onclick="viewDetail(${d.id})">View Report</button>
                <button class="btn btn-success" onclick="resendEmails(${d.id})">üìß Resend Emails</button>
                <button class="btn btn-danger" onclick="deleteEval(${d.id})">Delete</button>
            </div>
        </div>
    `).join('');
}

function viewDetail(id){
    const d = loadData().find(e=>e.id===id);
    if(!d) return;
    const w = window.open('','_blank','width=1100,height=900');
    w.document.write(`
        <!DOCTYPE html>
        <html><head><title>Report - ${d.studentName}</title>
        <style>
            body{font-family:Arial,sans-serif;padding:40px;max-width:1000px;margin:auto;background:#f9f9f9;line-height:1.6;}
            .header{background:var(--primary);color:white;padding:30px;border-radius:12px;text-align:center;margin-bottom:30px;}
            .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px;}
            .box{background:white;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
            .label{font-weight:bold;color:#555;}
            .section{background:white;padding:25px;border-radius:12px;margin-bottom:25px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
            .grade{padding:10px 25px;border-radius:30px;font-weight:700;display:inline-block;}
        </style></head>
        <body>
            <div class="header"><h1>Teaching Practice Evaluation Report</h1><p>National College of Education On Technology - Kuliyapitiya</p></div>
            <div class="grid">
                <div class="box"><div class="label">Student</div><div>${d.studentName} (${d.regNo})</div></div>
                <div class="box"><div class="label">School</div><div>${d.schoolName}</div></div>
                <div class="box"><div class="label">Evaluator</div><div>${d.evaluatorName} (${d.evaluatorRegNo})</div></div>
                <div class="box"><div class="label">Date</div><div>${new Date(d.evalDate).toLocaleDateString()}</div></div>
            </div>
            <div class="section">
                <h2>Final Result</h2>
                <p><strong>Score:</strong> ${d.totalMarks}/100 (${d.percentage}%)</p>
                <p><strong>Grade:</strong> <span class="grade ${d.grade.startsWith('A')?'grade-a':d.grade.startsWith('B')?'grade-b':d.grade.startsWith('C')?'grade-c':'grade-d'}">${d.grade}</span></p>
            </div>
            <div class="section">
                <h2>Section Breakdown</h2>
                <p>Planning: ${d.sectionScores.sec1.score}/20 (${d.sectionScores.sec1.perc}%)</p>
                <p>Implementation: ${d.sectionScores.sec2.score}/60 (${d.sectionScores.sec2.perc}%)</p>
                <p>Assessment: ${d.sectionScores.sec3.score}/10 (${d.sectionScores.sec3.perc}%)</p>
                <p>Personality: ${d.sectionScores.sec4.score}/10 (${d.sectionScores.sec4.perc}%)</p>
            </div>
            ${d.proposals?`<div class="section"><h2>Developmental Proposals / Strengths</h2><p>${d.proposals.replace(/\n/g,'<br>')}</p></div>`:''}
            <button onclick="window.print()" style="padding:12px 30px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;margin-right:15px;">Print Report</button>
            <button onclick="window.close()" style="padding:12px 30px;background:#666;color:white;border:none;border-radius:8px;cursor:pointer;">Close</button>
        </body></html>
    `);
}

function deleteEval(id){
    if(!confirm('Delete this evaluation permanently?')) return;
    let arr = loadData().filter(e=>e.id!==id);
    saveData(arr);
    loadRecords();
    loadDashboard();
    showAlert('Evaluation deleted','success');
}

function downloadCSV(){
    const data = loadData();
    if(!data.length){ showAlert('No data to export','error'); return; }
    let csv = 'Date,Reg No,Student,Evaluator (Reg),School,Total,Percentage,Grade,Planning,Implementation,Assessment,Personality,Proposals\n';
    data.forEach(d=>{
        const prop = (d.proposals||'').replace(/"/g,'""').replace(/\n/g,' ');
        csv += `"${d.evalDate}","${d.regNo}","${d.studentName}","${d.evaluatorName} (${d.evaluatorRegNo})","${d.schoolName}",${d.totalMarks},${d.percentage}%,${d.grade},${d.sectionScores.sec1.score},${d.sectionScores.sec2.score},${d.sectionScores.sec3.score},${d.sectionScores.sec4.score},"${prop}"\n`;
    });
    const blob = new Blob([csv],{type:'text/csv'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `NCOET_Evaluations_${new Date().toISOString().slice(0,10)}.csv`;
    link.click();
    showAlert('CSV exported','success');
}

function loadDashboard(){
    const data = loadData();
    document.getElementById('dashTotal').textContent = data.length;
    if(!data.length) return;
    const avg = (data.reduce((s,e)=>s+e.percentage,0)/data.length).toFixed(1);
    document.getElementById('dashAvg').textContent = avg+'%';
    document.getElementById('dashA').textContent = data.filter(e=>e.grade.startsWith('A')).length;
    document.getElementById('dashB').textContent = data.filter(e=>e.grade.startsWith('B')).length;
    document.getElementById('dashC').textContent = data.filter(e=>e.grade.startsWith('C')).length;

    const s1 = (data.reduce((s,e)=>s+parseFloat(e.sectionScores.sec1.perc),0)/data.length).toFixed(1);
    const s2 = (data.reduce((s,e)=>s+parseFloat(e.sectionScores.sec2.perc),0)/data.length).toFixed(1);
    const s3 = (data.reduce((s,e)=>s+parseFloat(e.sectionScores.sec3.perc),0)/data.length).toFixed(1);
    const s4 = (data.reduce((s,e)=>s+parseFloat(e.sectionScores.sec4.perc),0)/data.length).toFixed(1);
    document.getElementById('dashSec1').textContent = s1+'%';
    document.getElementById('dashSec2').textContent = s2+'%';
    document.getElementById('dashSec3').textContent = s3+'%';
    document.getElementById('dashSec4').textContent = s4+'%';
}

// Init
window.onload = ()=>{
    document.getElementById('evalDate').valueAsDate = new Date();
    attachListeners();
    updateLive();
    loadDashboard();
};
</script>
</body>
</html>